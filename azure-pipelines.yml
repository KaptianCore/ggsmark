trigger:
- master

pool:
  vmImage: ubuntu-latest

steps:
- task: NodeTool@0
  inputs:
    versionSpec: 14.x
  displayName: Install Node.js

- task: YarnInstaller@3
  inputs:
    versionSpec: 1.x
  displayName: Install Yarn

- script: |
    yarn
    yarn test
  displayName: Test

- task: PublishTestResults@2
  inputs:
    testResultsFormat: JUnit
    testResultsFiles: '**/test_results.xml'
    testRunTitle: Jest Tests
  
- task: Npm@1
  condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/master'))
  inputs:
    command: publish
    publishEndpoint: johnnyhuy-npm
  displayName: Publish Node package
